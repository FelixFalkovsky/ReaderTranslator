os: osx
osx_image: xcode11.1
language: swift
install:
  - |
    brew install create-dmg
    security create-keychain -p travis build.keychain
    security default-keychain -s build.keychain
    security unlock-keychain -p travis build.keychain
    echo $CERTIFICATE_OSX_P12 | base64 --decode > certificate.p12
    security import certificate.p12 -k build.keychain -P $CERTIFICATE_OSX_PASSWORD -T /usr/bin/codesign
    security set-key-partition-list -S apple-tool:,apple: -s -k travis build.keychain

script:
    - xcodebuild clean build -project ReaderTranslator.xcodeproj -scheme 'ReaderTranslatorMac' -sdk macosx -configuration Debug -derivedDataPath ./build | xcpretty -c
    - cp -R build/Build/Products/Debug/ReaderTranslatorMac.app .
    - create-dmg --volname "Application Installer" --hide-extension "Application.app" --app-drop-link 600 185 "ReaderTranslatorMac.dmg" "ReaderTranslatorMac.app/"
    - find ReaderTranslatorMac *.dmg
deploy:
  provider: releases
  file_glob: true
  skip_cleanup: true
  api_key:
    secure: EFHFwA1bdGZROxfu894FUvlwNg17CnvX6QjTHyxUsC5h6MAVIQ1y7OLUkpRf/EpSNv/EocW10/VbGfOgvwuxNXNG491F+mb4YSEuzNVBrjIaXBrivIRPsQRTnqxwiBu3KfyIsETizxmcE/1hcYJ66vUZ23/uJuFVUy7O/2kgQl47X7e7qi0bp450u+ua2Le34vESgvPz7DlA79jh/dZ+igxGYs0LXdtE8xU/FbXZHk8p8Ov8Z3qIq6AY38gc/4plyt8F/AVkUuOiK3MngkCwi52W/CkTORD9gx0s6k3z6tip/fAeJ5rrQ7OKR7b4Z24g9Bebzyh22PpjQMnerxsmmXMag0B8QSlnNM+NJKLAiExK3JAR0mOgflAMrQwSO3JxjOCNXKVXl0K5a8go16cdNi1fbGP0osMABUWA3pG/5saLcEM6iKh90hFSovTfQEwEizHHIILWqgzqmpiyCS0SFXUuxtDbCivzaOb/IFv1/DLBpESzlJ/SuOgvnJnmI0C6mw9w7ueMIER4tTytrbomgV3dcPaQrH5jrdlr3tN2JQigxWXVVqGLaRtpSJDCvvfDUMinWFLu0MbKWlbztnP3wtz00BcYOiUfBlManNK+CQOlt9TVvDIgrY2ToSYtFDuwiYTxCXqt0iDvIUXdFuWexT8OzxROmUfkZ3t1UZHrDIc=
  file:
    - ReaderTranslatorMac
    - ReaderTranslatorMac.dmg
  on:
    tags: true
    branch: master
    repo: filimo/ReaderTranslator
branches:
  only:
  - master
  - /^\d+\.\d+\.\d+.*$/
